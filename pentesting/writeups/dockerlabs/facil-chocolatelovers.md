# \[Fácil] ChocolateLovers

Escanemos puertos con nmap y vemos el puerto 80 y hacemos una fuerza bruta en busca de directorios pero no encontramos nada interesante, vemos que solo esta la web por defecto de apache, sin embargo, si inspeccionamos el codigo podemos ver que nos dice que ha habido un branch y una ruta, accedemos a esa ruta vemos otra web.

```
nmap --min-rate 3000 172.17.0.2 -n -v -Pn -p- -sCV -o scan
```

```
feroxbuster -u http://172.17.0.2:80 -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -o dir-files
```

<div align="left">

<figure><img src="../../../.gitbook/assets/image (72).png" alt="" width="497"><figcaption></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../../.gitbook/assets/image (73).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

Vamos a probar a hacer un una fuerza bruta en busca de ficheros y carpetas en /nibbleblog, y vemos que en la pagina admin.php hay un login

```
gobuster -u http://172.17.0.2/nibbleblog/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt dir -x txt,php,py,html,txt,sh,js -o buster-nibbleblog
```

<div align="left">

<figure><img src="../../../.gitbook/assets/image (74).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

No ha hecho falta hacer nada, con el usuario admin y contraseña admin nos podemos loguear

<div align="left">

<figure><img src="../../../.gitbook/assets/image (77).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../../.gitbook/assets/image (75).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

Existe un exploit para este CMS, sin embargo, en este caso por algun motivo nos da error

<div align="left">

<figure><img src="../../../.gitbook/assets/image (79).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../../.gitbook/assets/image (78).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

Viendo el codigo del exploit, nos damos cuenta que explota un plugin llamado My image, por lo que vamos a instalarlo en la web

<div align="left">

<figure><img src="../../../.gitbook/assets/image (80).png" alt="" width="261"><figcaption></figcaption></figure>

</div>

He cargado la shell en el pligin my image y luego me he dirigido a la ruta donde se ha guardado, nos ponemos en el puerto de escucha, ejecutamos el fichero y ya tenemos una shell. El archvio que subamos va a ser renombrado con 'image.\*'

<div align="left">

<figure><img src="../../../.gitbook/assets/image (81).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../../.gitbook/assets/image (84).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

<div align="left">

<figure><img src="../../../.gitbook/assets/image (85).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

Escalada de privilegios

Vemos que podemos ejecutar php con el usuario chocolate, vemos en GTFObins informacion sobre como escalar privilegios.

<div align="left">

<figure><img src="../../../.gitbook/assets/image (86).png" alt="" width="563"><figcaption></figcaption></figure>

</div>

```
CMD="/bin/sh"
sudo -u chocolate /usr/bin/php -r "system('$CMD');"
```

